!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).i18nextMF2=e()}(this,(function(){"use strict";function t(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function e(t,e,n){return(e=o(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(Object(o),!0).forEach((function(n){e(t,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function o(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}const i=/^[\u061c\u200e\u200f\u2066-\u2069]+/,s=/^[-.+0-9A-Z_a-z\u{a1}-\u{61b}\u{61d}-\u{167f}\u{1681}-\u{1fff}\u{200b}-\u{200d}\u{2010}-\u{2027}\u{2030}-\u{205e}\u{2060}-\u{2065}\u{206a}-\u{2fff}\u{3001}-\u{d7ff}\u{e000}-\u{fdcf}\u{fdf0}-\u{fffd}\u{10000}-\u{1fffd}\u{20000}-\u{2fffd}\u{30000}-\u{3fffd}\u{40000}-\u{4fffd}\u{50000}-\u{5fffd}\u{60000}-\u{6fffd}\u{70000}-\u{7fffd}\u{80000}-\u{8fffd}\u{90000}-\u{9fffd}\u{a0000}-\u{afffd}\u{b0000}-\u{bfffd}\u{c0000}-\u{cfffd}\u{d0000}-\u{dfffd}\u{e0000}-\u{efffd}\u{f0000}-\u{ffffd}\u{100000}-\u{10fffd}]+/u,a=/^[-.0-9]/;const c=Symbol.for("CST");class u extends Error{type;constructor(t,e){super(e),this.type=t}}class l extends u{start;end;constructor(t,e,n,r){let o=r?`Missing ${r}`:t;e>=0&&(o+=` at ${e}`),super(t,o),this.start=e,this.end=n??e+1}}class f extends l{constructor(t,e){const{start:n,end:r}=e[c]??{start:-1,end:-1};super(t,n,r)}}class p extends u{source;constructor(t,e,n){super(t,e),this.source=n}}class d extends u{cause;constructor(t,e){super(t,`Selection error: ${t}`),void 0!==e&&(this.cause=e)}}const h=new Set("؜‎‏⁦⁧⁨⁩"),m=new Set("\t\n\r 　");let y,b;const g=(t,e)=>new l("missing-syntax",t,t+e.length,e),v=(...t)=>new l(...t);function w(t,e){if(!b.startsWith(t,y))throw g(y,t);e&&(y+=t.length)}function k(t){y=0,b=t;const e=function(){const t=[];N();t:for(;"."===b[y];){switch(b.substr(y,6)){case".input":t.push(j());break;case".local":t.push(x());break;case".match":break t;default:throw v("parse-error",y)}N()}return t}();if(b.startsWith(".match",y))return function(t){y+=6,N(!0);const e=[];for(;"$"===b[y];)e.push(F()),N(!0);if(0===e.length)throw v("empty-token",y);const n=[];for(;y<b.length;)n.push(O()),N();return{type:"select",declarations:t,selectors:e,variants:n}}(e);const n=e.length>0||b.startsWith("{{",y);!n&&y>0&&(y=0);const r=S(n);if(n&&(N(),y<b.length))throw v("extra-content",y,b.length);return{type:"message",declarations:e,pattern:r}}function O(){const t=[];for(;y<b.length;){N(!!t.length&&"{");const e=b[y];if("{"===e)break;if("*"===e)t.push({type:"*"}),y+=1;else{const e=M(!0);e.value=e.value.normalize(),t.push(e)}}return{keys:t,value:S(!0)}}function S(t){if(t){if(!b.startsWith("{{",y))throw g(y,"{{");y+=2}const e=[];t:for(;y<b.length;)switch(b[y]){case"{":e.push(D(!0));break;case"}":if(!t)throw v("parse-error",y);break t;default:e.push(I())}if(t){if(!b.startsWith("}}",y))throw g(y,"}}");y+=2}return e}function j(){y+=6,N(),w("{",!1);const t=y,e=D(!1);if("expression"===e.type&&"variable"===e.arg?.type)return{type:"input",name:e.arg.name,value:e};throw v("bad-input-expression",t,y)}function x(){y+=6,N(!0),w("$",!0);const t=z();N(),w("=",!0),N(),w("{",!1);return{type:"local",name:t,value:D(!1)}}function D(t){const e=y;y+=1,N();const n=$(!1);n&&N("}");const r=b[y];let o,i;switch(r){case"@":case"}":break;case":":{y+=1,o={type:"function",name:P()};const t=E();t&&(o.options=t);break}case"#":case"/":{if(n||!t)throw v("parse-error",y);y+=1;i={type:"markup",kind:"#"===r?"open":"close",name:P()};const e=E();e&&(i.options=e);break}default:throw v("parse-error",y)}const s=function(){const t=new Map;let e=!0;for(;"@"===b[y];){const n=y;y+=1;const r=P();if(t.has(r))throw v("duplicate-attribute",n,y);N("=/}"),"="===b[y]?(y+=1,N(),t.set(r,M(!0)),N("/}")):t.set(r,!0),e=!1}return e?null:t}();if("open"===i?.kind&&"/"===b[y]&&(i.kind="standalone",y+=1),w("}",!0),o){const t=n?{type:"expression",arg:n,functionRef:o}:{type:"expression",functionRef:o};return s&&(t.attributes=s),t}if(i)return s&&(i.attributes=s),i;if(!n)throw v("empty-token",e,y);return s?{type:"expression",arg:n,attributes:s}:{type:"expression",arg:n}}function E(){N("/}");const t=new Map;let e=!0;for(;y<b.length;){const n=b[y];if("@"===n||"/"===n||"}"===n)break;const r=y,o=P();if(t.has(o))throw v("duplicate-option-name",r,y);N(),w("=",!0),N(),t.set(o,$(!0)),e=!1,N("/}")}return e?null:t}function I(){let t="",e=y;t:for(;e<b.length;++e)switch(b[e]){case"\\":{const n=b[e+1];if(!"\\{|}".includes(n))throw v("bad-escape",e,e+2);t+=b.substring(y,e)+n,e+=1,y=e+1;break}case"{":case"}":break t}return t+=b.substring(y,e),y=e,t}function $(t){return"$"===b[y]?F():M(t)}function F(){return y+=1,{type:"variable",name:z()}}function M(t){if("|"===b[y])return function(){y+=1;let t="";for(let e=y;e<b.length;++e)switch(b[e]){case"\\":{const n=b[e+1];if(!"\\{|}".includes(n))throw v("bad-escape",e,e+2);t+=b.substring(y,e)+n,e+=1,y=e+1;break}case"|":return t+=b.substring(y,e),y=e+1,{type:"literal",value:t}}throw g(b.length,"|")}();const e=((t,e)=>t.slice(e).match(s)?.[0]??"")(b,y);if(e)return y+=e.length,{type:"literal",value:e};if(t)throw v("empty-token",y)}function P(){const t=z();return":"===b[y]?(y+=1,t+":"+z()):t}function z(){const t=function(t,e){let n=e;const r=t.slice(n).match(i);r&&(n+=r[0].length);const o=t.slice(n).match(s);if(!o)return null;const c=o[0];if(a.test(c))return null;n+=c.length;const u=t.slice(n).match(i);return u&&(n+=u[0].length),{value:c.normalize(),end:n}}(b,y);if(!t)throw v("empty-token",y);return y=t.end,t.value}function N(t=!1){let e=b[y],n=!1;if(t){for(;h.has(e);)e=b[++y];for(;m.has(e);)e=b[++y],n=!0}for(;h.has(e)||m.has(e);)e=b[++y];if(t&&!n&&(!0===t||!t.includes(b[y])))throw g(y,"' '")}const T="⁨",K="⁩";function R(t){if(t)try{"string"==typeof t&&(t=new Intl.Locale(t));const e=t.getTextInfo?.()??t.textInfo;if(e?.direction)return e.direction;const n=t.maximize().script;if(n)return"Adlm,Arab,Hebr,Mand,Nkoo,Rohg,Syrc,Thaa".includes(n)?"rtl":"ltr"}catch{}return"auto"}function V(t){if(t&&"object"==typeof t&&(t=t.valueOf()),"boolean"==typeof t)return t;if(t&&"object"==typeof t&&(t=String(t)),"true"===t)return!0;if("false"===t)return!1;throw new RangeError("Not a boolean")}function A(t){if(t&&"object"==typeof t&&(t=t.valueOf()),t&&"object"==typeof t&&(t=String(t)),"string"==typeof t&&/^(0|[1-9][0-9]*)$/.test(t)&&(t=Number(t)),"number"==typeof t&&t>=0&&Number.isInteger(t))return t;throw new RangeError("Not a positive integer")}function C(t){if(t&&"object"==typeof t&&(t=t.valueOf()),"string"==typeof t)return t;if(t&&"object"==typeof t)return String(t);throw new RangeError("Not a string")}function L(t,e){let n;if("object"==typeof t){const e=t?.valueOf;"function"==typeof e&&(n=t.options,t=e.call(t))}if("string"==typeof t)try{t=JSON.parse(t)}catch{}if("bigint"!=typeof t&&"number"!=typeof t){throw new p("bad-operand","Input is not numeric",e)}return{value:t,options:n}}function W(t,e,n,r){let o,i,s,a,{dir:c,locales:u,source:l}=t;if("never"===n.useGrouping&&(n.useGrouping=!1),r&&"select"in n&&!t.literalOptionKeys.has("select")){const e="The option select may only be set by a literal value";t.onError(new p("bad-option",e,l)),r=!1}return{type:"number",source:l,get dir(){return null==c&&(o??=Intl.NumberFormat.supportedLocalesOf(u,n)[0],c=R(o)),c},get options(){return{...n}},selectKey:r?t=>{const r=String(e);if(t.has(r))return r;if("exact"===n.select)return null;const o=n.select?{...n,select:void 0,type:n.select}:n;return s??=new Intl.PluralRules(u,o).select(Number(e)),t.has(s)?s:null}:void 0,toParts(){i??=new Intl.NumberFormat(u,n);const t=i.formatToParts(e);return o??=i.resolvedOptions().locale,c??=R(o),"ltr"===c||"rtl"===c?[{type:"number",source:l,dir:c,locale:o,parts:t}]:[{type:"number",source:l,locale:o,parts:t}]},toString:()=>(i??=new Intl.NumberFormat(u,n),a??=i.format(e),a),valueOf:()=>e}}function Z(t,e,n){const r=L(n,t.source),o=r.value,i=Object.assign({},r.options,{localeMatcher:t.localeMatcher,style:"decimal"});for(const[n,r]of Object.entries(e))if(void 0!==r)try{switch(n){case"minimumIntegerDigits":case"minimumFractionDigits":case"maximumFractionDigits":case"minimumSignificantDigits":case"maximumSignificantDigits":case"roundingIncrement":i[n]=A(r);break;case"roundingMode":case"roundingPriority":case"select":case"signDisplay":case"trailingZeroDisplay":case"useGrouping":i[n]=C(r)}}catch{const e=`Value ${r} is not valid for :number option ${n}`;t.onError(new p("bad-option",e,t.source))}return W(t,o,i,!0)}const G=new Set(["dateStyle","timeStyle"]),H=new Set(["weekday","era","year","month","day","hour","minute","second","fractionalSecondDigits","timeZoneName"]);function U(t,e,n){const{localeMatcher:r,locales:o,source:i}=t,s={localeMatcher:r};let a;switch(e&&"object"==typeof e&&(e&&"options"in e&&Object.assign(s,e.options),e instanceof Date||"function"!=typeof e.valueOf||(e=e.valueOf())),typeof e){case"number":case"string":a=new Date(e);break;case"object":a=e}if(!(a instanceof Date)||isNaN(a.getTime())){throw new p("bad-operand","Input is not a date",i)}n(s);const c=a;let u,l,f,d=t.dir;return{type:"datetime",source:i,get dir(){return null==d&&(u??=Intl.DateTimeFormat.supportedLocalesOf(o,s)[0],d=R(u)),d},get options(){return{...s}},toParts(){l??=new Intl.DateTimeFormat(o,s);const t=l.formatToParts(c);return u??=l.resolvedOptions().locale,d??=R(u),"ltr"===d||"rtl"===d?[{type:"datetime",source:i,dir:d,locale:u,parts:t}]:[{type:"datetime",source:i,locale:u,parts:t}]},toString:()=>(l??=new Intl.DateTimeFormat(o,s),f??=l.format(c),f),valueOf:()=>c}}function q(t,e,n){const r=void 0===n?"":String(n),o=r.normalize();return{type:"string",source:t.source,dir:t.dir??"auto",selectKey:t=>t.has(o)?o:null,toParts(){const{dir:e,source:n}=t,o=t.locales[0];return"ltr"===e||"rtl"===e?[{type:"string",source:n,dir:e,locale:o,value:r}]:[{type:"string",source:n,locale:o,value:r}]},toString:()=>r,valueOf:()=>r}}let J={integer:function(t,e,n){const r=L(n,t.source),o=Number.isFinite(r.value)?Math.round(r.value):r.value,i=Object.assign({},r.options,{maximumFractionDigits:0,minimumFractionDigits:void 0,minimumSignificantDigits:void 0,style:"decimal"});for(const[n,r]of Object.entries(e))if(void 0!==r)try{switch(n){case"minimumIntegerDigits":case"maximumSignificantDigits":i[n]=A(r);break;case"select":case"signDisplay":case"useGrouping":i[n]=C(r)}}catch{const e=`Value ${r} is not valid for :integer option ${n}`;t.onError(new p("bad-option",e,t.source))}return W(t,o,i,!0)},number:Z,string:q};J=Object.freeze(Object.assign(Object.create(null),J));let B={currency:function(t,e,n){const{source:r}=t,o=L(n,r),i=Object.assign({},o.options,{localeMatcher:t.localeMatcher,style:"currency"});for(const[n,o]of Object.entries(e))if(void 0!==o)try{switch(n){case"currency":case"currencySign":case"roundingMode":case"roundingPriority":case"trailingZeroDisplay":case"useGrouping":i[n]=C(o);break;case"minimumIntegerDigits":case"minimumSignificantDigits":case"maximumSignificantDigits":case"roundingIncrement":i[n]=A(o);break;case"currencyDisplay":{const e=C(o);"never"===e?t.onError(new p("unsupported-operation",'Currency display "never" is not yet supported',r)):i[n]=e;break}case"fractionDigits":{const t=C(o);if("auto"===t)i.minimumFractionDigits=void 0,i.maximumFractionDigits=void 0;else{const e=A(t);i.minimumFractionDigits=e,i.maximumFractionDigits=e}break}}}catch(e){if(e instanceof u)t.onError(e);else{const e=`Value ${o} is not valid for :currency option ${n}`;t.onError(new p("bad-option",e,r))}}if(!i.currency){throw new p("bad-operand","A currency code is required for :currency",r)}return W(t,o.value,i,!1)},date:(t,e,n)=>U(t,n,(n=>{for(const t of Object.keys(n))(G.has(t)||H.has(t))&&delete n[t];for(const[r,o]of Object.entries(e))if(void 0!==o)try{switch(r){case"style":n.dateStyle=C(o);break;case"hour12":n[r]=V(o);break;case"calendar":case"timeZone":n[r]=C(o)}}catch{const e=`Value ${o} is not valid for :date ${r} option`;t.onError(new p("bad-option",e,t.source))}n.dateStyle??="medium"})),datetime:(t,e,n)=>U(t,n,(n=>{let r=!1,o=!1;for(const[i,s]of Object.entries(e))if(void 0!==s)try{switch(i){case"locale":break;case"fractionalSecondDigits":n[i]=A(s),o=!0;break;case"hour12":n[i]=V(s);break;default:n[i]=C(s),!r&&G.has(i)&&(r=!0),!o&&H.has(i)&&(o=!0)}}catch{const e=`Value ${s} is not valid for :datetime ${i} option`;t.onError(new p("bad-option",e,t.source))}if(r||o){if(r&&o){throw new p("bad-option","Style and field options cannot be both set for :datetime",t.source)}}else n.dateStyle="medium",n.timeStyle="short"})),math:function(t,e,n){const{source:r}=t;let o,i,{value:s,options:a}=L(n,r);try{o="add"in e?A(e.add):-1,i="subtract"in e?A(e.subtract):-1}catch(t){throw new p("bad-option",String(t),r)}if(o<0==i<0){throw new p("bad-option",'Exactly one of "add" or "subtract" is required as a :math option',r)}const c=o<0?-i:o;return s+="number"==typeof s?c:BigInt(c),Z(t,{},{valueOf:()=>s,options:a})},time:(t,e,n)=>U(t,n,(n=>{for(const t of Object.keys(n))(G.has(t)||H.has(t))&&delete n[t];for(const[r,o]of Object.entries(e))if(void 0!==o)try{switch(r){case"style":n.timeStyle=C(o);break;case"hour12":n[r]=V(o);break;case"calendar":case"timeZone":n[r]=C(o)}}catch{const e=`Value ${o} is not valid for :time ${r} option`;t.onError(new p("bad-option",e,t.source))}n.timeStyle??="short"})),unit:function(t,e,n){const{source:r}=t,o=L(n,r),i=Object.assign({},o.options,{localeMatcher:t.localeMatcher,style:"unit"});for(const[n,o]of Object.entries(e))if(void 0!==o)try{switch(n){case"signDisplay":case"roundingMode":case"roundingPriority":case"trailingZeroDisplay":case"unit":case"unitDisplay":case"useGrouping":i[n]=C(o);break;case"minimumIntegerDigits":case"minimumFractionDigits":case"maximumFractionDigits":case"minimumSignificantDigits":case"maximumSignificantDigits":case"roundingIncrement":i[n]=A(o)}}catch(e){if(e instanceof u)t.onError(e);else{const e=`Value ${o} is not valid for :currency option ${n}`;t.onError(new p("bad-option",e,r))}}if(!i.unit){throw new p("bad-operand","A unit identifier is required for :unit",r)}return W(t,o.value,i,!1)}};B=Object.freeze(Object.assign(Object.create(null),B));const _=Symbol("bidi-isolate"),Q=(t="�")=>({type:"fallback",source:t,toParts:()=>[{type:"fallback",source:t}],toString:()=>`{${t}}`});class X{#t;#e;dir;id;source;constructor(t,e,n){this.#t=t,this.dir=void 0;const r=n?.get("u:dir");if(r){const e=String(st(t,r));if("ltr"===e||"rtl"===e||"auto"===e)this.dir=e;else if("inherit"!==e){const e="Unsupported value for u:dir option",n=at(r);t.onError(new p("bad-option",e,n))}}const o=n?.get("u:id");if(this.id=o?String(st(t,o)):void 0,n){this.#e=new Set;for(const[t,e]of n)"literal"===e.type&&this.#e.add(t)}this.source=e}get literalOptionKeys(){return new Set(this.#e)}get localeMatcher(){return this.#t.localeMatcher}get locales(){return this.#t.locales.map(String)}get onError(){return this.#t.onError}}function Y(t,e,{name:n,options:r}){const o=at(e)??`:${n}`;try{const i=e?[st(t,e)]:[],s=t.functions[n];if(!s)throw new u("unknown-function",`Unknown function :${n}`);const a=new X(t,o,r),c=function(t,e){const n=Object.create(null);if(e)for(const[r,o]of e)r.startsWith("u:")||(n[r]=st(t,o));return n}(t,r);let l=s(a,c,...i);if(null===l||"object"!=typeof l&&"function"!=typeof l||"string"!=typeof l.type||"string"!=typeof l.source)throw new u("bad-function-result",`Function :${n} did not return a MessageValue`);return a.dir&&(l={...l,dir:a.dir,[_]:!0}),a.id&&"function"==typeof l.toParts?{...l,toParts(){const t=l.toParts();for(const e of t)e.id=a.id;return t}}:l}catch(e){return t.onError(e),Q(o)}}function tt(t,{arg:e,functionRef:n}){if(n)return Y(t,e,n);switch(e?.type){case"literal":return function(t,e){return q(new X(t,`|${e.value}|`),0,e.value)}(t,e);case"variable":return it(t,e);default:throw new Error(`Unsupported expression: ${e?.type}`)}}class et{expression;scope;constructor(t,e){this.expression=t,this.scope=e}}const nt=t=>null!==t&&("object"==typeof t||"function"==typeof t);function rt(t,e){if(nt(t)){if(e in t)return t[e];const n=e.split(".");for(let e=n.length-1;e>0;--e){const r=n.slice(0,e).join(".");if(r in t){const o=n.slice(e).join(".");return rt(t[r],o)}}for(const[n,r]of Object.entries(t))if(n.normalize()===e)return r}}function ot(t,{name:e}){const n=rt(t.scope,e);if(void 0===n){const n="$"+e,r=`Variable not available: ${n}`;t.onError(new p("unresolved-variable",r,n))}else if(n instanceof et){const r=tt(n.scope?{...t,scope:n.scope}:t,n.expression);return t.scope[e]=r,t.localVars.add(r),r}return n}function it(t,e){const n="$"+e.name,r=ot(t,e);let o=typeof r;if("object"===o){const e=r;if("fallback"===e.type)return Q(n);if(t.localVars.has(e))return e;r instanceof Number?o="number":r instanceof String&&(o="string")}switch(o){case"bigint":case"number":{const e=new X(t,n);return t.functions.number(e,{},r)}case"string":{const e=new X(t,n);return t.functions.string(e,{},r)}}return void 0===r?Q(n):((t,e)=>({type:"unknown",source:t,dir:"auto",toParts:()=>[{type:"unknown",source:t,value:e}],toString:()=>String(e),valueOf:()=>e}))(n,r)}function st(t,e){switch(e.type){case"literal":return e.value;case"variable":return ot(t,e);default:throw new Error(`Unsupported value: ${e.type}`)}}function at(t){switch(t?.type){case"literal":return"|"+t.value.replaceAll("\\","\\\\").replaceAll("|","\\|")+"|";case"variable":return"$"+t.name;default:return}}function ct(t,{kind:e,name:n,options:r}){const o={type:"markup",kind:e,source:"close"===e?`/${n}`:"open"===e?`#${n}`:`#${n}/`,name:n};if(r?.size){o.options={};for(const[e,n]of r)if("u:dir"===e){const r=`The option ${e} is not valid for markup`,o=at(n);t.onError(new p("bad-option",r,o))}else{let r=st(t,n);"object"==typeof r&&"function"==typeof r?.valueOf&&(r=r.valueOf()),"u:id"===e?o.id=String(r):o.options[e]=r}}return o}function ut(t,e){switch(e.type){case"message":return e.pattern;case"select":{const n=e.selectors.map((e=>{const n=it(t,e);let r;return"function"==typeof n.selectKey?r=n.selectKey.bind(n):(t.onError(new d("bad-selector")),r=()=>null),{selectKey:r,best:null,keys:null}}));let r=e.variants;t:for(let o=0;o<n.length;++o){const i=n[o];if(!i.keys){i.keys=new Set;for(const{keys:t}of r){const e=t[o];if(!e)break t;"*"!==e.type&&i.keys.add(e.value)}}try{i.best=i.keys.size?i.selectKey(i.keys):null}catch(e){t.onError(new d("bad-selector",e)),i.selectKey=()=>null,i.best=null}if(r=r.filter((t=>{const e=t.keys[o];return"*"===e.type?null==i.best:i.best===e.value})),0===r.length){if(0===o)break;const t=n[o-1];null==t.best?t.keys?.clear():t.keys?.delete(t.best);for(let t=o;t<n.length;++t)n[t].keys=null;r=e.variants,o=-1}}const o=r[0];return o?o.value:(t.onError(new d("no-match")),[])}default:return t.onError(new d("bad-selector")),[]}}class lt{#n;#r;#o;#i;#s;#a;constructor(t,e,n){this.#n="none"!==n?.bidiIsolation,this.#o=n?.localeMatcher??"best fit",this.#i=Array.isArray(t)?t.map((t=>new Intl.Locale(t))):t?[new Intl.Locale(t)]:[],this.#r=n?.dir??R(this.#i[0]),this.#s="string"==typeof e?k(e):e,function(t,e=(t,e)=>{throw new f(t,e)}){let n=0,r=null;const o=new Set,i=new Set,s=new Set,a=new Set,c=new Set,u=new Set;let l=!0;!function(t,e){const{node:n,pattern:r}=e,{functionRef:o=n,attributes:i=null,declaration:s=n,expression:a=n,key:c=n,markup:u=n,options:l=null,value:f=n,variant:p=n}=e,d=(t,e)=>{if(t){const n=l?.(t,e);if(f)for(const n of t.values())f(n,e,"option");n?.()}},h=(t,e)=>{if(t){const n=i?.(t,e);if(f)for(const n of t.values())!0!==n&&f(n,e,"attribute");n?.()}},m=(t,e)=>{if("object"==typeof t){let n;switch(t.type){case"expression":if(n=a?.(t,e),t.arg&&f?.(t.arg,e,"arg"),t.functionRef){const n=o?.(t.functionRef,e,t.arg);d(t.functionRef.options,e),n?.()}h(t.attributes,e);break;case"markup":n=u?.(t,e),d(t.options,e),h(t.attributes,e)}n?.()}},y=t=>{const e=r?.(t);for(const e of t)m(e,"placeholder");e?.()};for(const e of t.declarations){const t=s?.(e);e.value&&m(e.value,"declaration"),t?.()}if("message"===t.type)y(t.pattern);else{if(f)for(const e of t.selectors)f(e,"selector","arg");for(const e of t.variants){const t=p?.(e);c&&e.keys.forEach(c),y(e.value),t?.()}}}(t,{declaration(t){if(t.name)return(t.value.functionRef||"local"===t.type&&"variable"===t.value.arg?.type&&o.has(t.value.arg.name))&&o.add(t.name),"local"===t.type&&a.add(t.name),l="local"===t.type,()=>{i.has(t.name)?e("duplicate-declaration",t):i.add(t.name)}},expression({functionRef:t}){t&&s.add(t.name)},value(t,s,a){if("variable"===t.type)switch(c.add(t.name),s){case"declaration":("arg"!==a||l)&&i.add(t.name);break;case"selector":n+=1,r=t,o.has(t.name)||e("missing-selector-annotation",t)}},variant(t){const{keys:o}=t;o.length!==n&&e("key-mismatch",t);const i=JSON.stringify(o.map((t=>"literal"===t.type?t.value:0)));u.has(i)?e("duplicate-variant",t):u.add(i),r&&=o.every((t=>"*"===t.type))?null:t}}),r&&e("missing-fallback",r);for(const t of a)c.delete(t)}(this.#s),this.#a=n?.functions?Object.assign(Object.create(null),J,n.functions):J}format(t,e){const n=this.#c(t,e);let r="";for(const t of ut(n,this.#s))if("string"==typeof t)r+=t;else if("markup"===t.type)ct(n,t);else{let e;try{if(e=tt(n,t),"function"!=typeof e.toString){throw new u("not-formattable","Message part is not formattable")}if(this.#n&&("ltr"!==this.#r||"ltr"!==e.dir||e[_])){r+=("ltr"===e.dir?"⁦":"rtl"===e.dir?"⁧":T)+e.toString()+K}else r+=e.toString()}catch(t){n.onError(t);const o=`{${e?.source??"�"}}`;r+=this.#n?T+o+K:o}}return r}formatToParts(t,e){const n=this.#c(t,e),r=[];for(const t of ut(n,this.#s))if("string"==typeof t)r.push({type:"text",value:t});else if("markup"===t.type)r.push(ct(n,t));else{let e;try{if(e=tt(n,t),"function"!=typeof e.toParts){throw new u("not-formattable","Message part is not formattable")}{const t=e.toParts();if(this.#n&&("ltr"!==this.#r||"ltr"!==e.dir||e[_])){const n="ltr"===e.dir?"⁦":"rtl"===e.dir?"⁧":T;r.push({type:"bidiIsolation",value:n},...t,{type:"bidiIsolation",value:K})}else r.push(...t)}}catch(t){n.onError(t);const o={type:"fallback",source:e?.source??"�"};this.#n?r.push({type:"bidiIsolation",value:T},o,{type:"bidiIsolation",value:K}):r.push(o)}}return r}#c(t,e=t=>{try{process.emitWarning(t)}catch{console.warn(t)}}){const n={...t};for(const e of this.#s.declarations)n[e.name]=new et(e.value,"input"===e.type?t??{}:void 0);return{onError:e,localeMatcher:this.#o,locales:this.#i,localVars:new WeakSet,functions:this.#a,scope:n}}}function ft(t,e,n){function r(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}function o(){return!t||"string"==typeof t}for(var i="string"!=typeof e?[].concat(e):e.split(".");i.length>1;){if(o())return{};var s=r(i.shift());!t[s]&&n&&(t[s]=new n),t=t[s]}return o()?{}:{obj:t,k:r(i.shift())}}var pt=function(){return t((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type="i18nFormat",this.mem={},this.init(null,e)}),[{key:"init",value:function(t,e){var n=this;if(this.options=Object.assign({memoize:!0,memoizeFallback:!1,bindI18n:"",bindI18nStore:"",mf2DraftFunctions:!1,mf2Functions:void 0,parseErrorHandler:function(t,e,n,r){return n},parseLngForMF2:function(t){return t}},this.options,e,t&&t.options&&t.options.i18nFormat),t){var r=this.options,o=r.bindI18n,i=r.bindI18nStore,s=r.memoize;t.MessageFormat=Intl.MessageFormat,t.MF2=this,s&&(o&&t.on(o,(function(){return n.clearCache()})),i&&t.store.on(i,(function(){return n.clearCache()})))}}},{key:"parse",value:function(t,e,n,o,i,s){var a,c,u,l,f=this,p=s&&s.resolved&&s.resolved.res,d=this.options.memoize&&"".concat(n,".").concat(o,".").concat(i.replace(/\./g,"###"));this.options.memoize&&(a=function(t,e){var n=ft(t,e),r=n.obj,o=n.k;if(r)return r[o]}(this.mem,d));try{if(!a){var h=this.options.parseLngForMF2(n),m=this.options.mf2Functions;this.options.mf2DraftFunctions&&(m=r(r({},B),m)),a=new lt(h,t,{functions:m}),this.options.memoize&&(this.options.memoizeFallback||!s||p)&&(c=this.mem,u=a,(l=ft(c,d,Object)).obj[l.k]=u)}return a.format(e,(function(n){return f.options.parseErrorHandler(n,i,t,e)}))}catch(n){return this.options.parseErrorHandler(n,i,t,e)}}},{key:"addLookupKeys",value:function(t,e,n,r,o){return t}},{key:"clearCache",value:function(){this.mem={}}}])}();return pt.type="i18nFormat",pt}));